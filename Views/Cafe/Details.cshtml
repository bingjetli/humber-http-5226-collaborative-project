@model humber_http_5226_collaborative_project.Models.ViewModels.DetailsCafe

@{
    ViewBag.Title = "Details";
}

<h2>Details</h2>

<!--Back to list button-->
<a href="/Cafe/List">Back to List</a>

<!--Cafe information for selected cafe-->
<h3>@Model.cafe.Name</h3>
<div>@Model.cafe.Address</div>
<div>@Model.cafe.OverpassId</div>
<div>@Model.cafe.Latitude</div>
<div>@Model.cafe.Longitude</div>
<div>@Model.cafe.Phone</div>
<div>@Model.cafe.Description</div>
<div>@Model.cafe.Website</div>

<!--Cafe menu for selected cafe-->
<h3>Menu</h3>
@if (Model.cafe != null && Model.cafe.Any())
{
    <ul>
        @foreach (var item in Model.AvailableItems)
        {
            <li>
                <strong>@item.Name</strong> - @item.Description - $@item.Price
                <!--Option to remove item from menu-->
                <a href="/Cafe/UnlinkWithItem/@Model.cafe.CafeId?ItemId=@item.ItemId">[x]</a>
            </li>
        }
    </ul>

    <!--Dropdown to add item to menu-->
    <h4>Add New Menu Item to @Model.cafe.Name</h4>
    <form method="POST" action="/Cafe/LinkToItem/@Model.cafe.CafeId">
        <select name="ItemId">
            @foreach (var item in Model.UnavailableItems)
            {
                <option value="@item.ItemId">@item.Name</option>
            }
        </select>
        <input type="submit" value="Add Item" />
    </form>
    <!-- NOTE: Add 'SelectedCafe' for values-->
    <!-- NOTE: Update 'CurrentItems' in Cafe Controller-->
}
else
{
    <div>No menu items available.</div>
}

<!--Order history for selected cafe-->
<h3>Order History</h3>
@if (Model.AvailableOrders != null && Model.AvailableOrders.Any())
{
    <table>
        <thead>
            <tr>
                <th>Order ID</th>
                <th>Cafe</th>
                <th>Created At</th>
                <th>Details</th>
                <th>Remove</th>
            </tr>
        </thead>
        <tbody>
            @foreach (var order in Model.AvailableOrders)
            {
                <tr>
                    <td>@order.OrderId</td>
                    <td>@Model.cafe.Name</td>
                    <td>@order.CreatedAt.ToString("g")</td> <!--  ToString("g") method formats the CreatedAt datetime in a general, short format for readability -->
                    <td>
                        @foreach (var item in Model.OrderItems)
                        {
                            <p>@item.Item.Name - Quantity: @item.Quantity</p>
                        }
                    </td>
                    <td>
                        <!--Option to remove order from order history-->
                        <a href="/Cafe/UnlinkWithOrder/@Model.cafe.CafeId?OrderId=@order.OrderId">[x]</a>
                    </td>
                </tr>
            }
        </tbody>
    </table>

    <!--Add an order to a cafe's order history-->
    <h4>Add New Order to @Model.Name</h4>
    <form method="POST" action="/Cafe/LinkToOrder/@Model.CafeId">
        <select name="OrderId">
            @foreach (var order in Model.Orders)
            {
                <option value="@order.OrderId">@order.OrderId</option>
            }
        </select>
        <input type="submit" value="Add Order" />
    </form>
    <!-- NOTE: Add 'SelectedCafe' for values-->
    <!--NOTE: Update 'CurrentOrders' in Cafe Controller-->
    <!-- NOTE: Simplify order linking with server-side rendering (or AJAX) -->
}
else
{
    <div>No orders found.</div>
}

<!--Option to update or delete cafe-->
<div>
    <a href="/Cafe/Edit/@Model.CafeId">Update</a>
    <a href="/Cafe/DeleteConfirm/@Model.CafeId">Delete</a>
</div>
